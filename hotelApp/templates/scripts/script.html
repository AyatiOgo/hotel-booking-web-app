<script> 

const disabledDates = JSON.parse(
        document.getElementById("disabled-dates-data").textContent
    );
console.log(disabledDates)
const calendarWrapper = document.getElementById("calendarWrapper");

let checkinDate = null;
let checkoutDate = null;

// ðŸ”‘ STORE INSTANCES


// Checkout calendar (defined FIRST so we can reference it)
const checkoutCalendar = flatpickr("#checkout", {
    dateFormat: "Y-m-d",
    minDate: "today",
    disable: disabledDates,
    onChange: function (selectedDates, dateStr) {
        checkoutDate = dateStr;

        if (checkinDate && checkoutDate) {
            document.getElementById("continueBtn").disabled = false;
        }
    }
});

const checkinCalendar = flatpickr("#checkin", {
    dateFormat: "Y-m-d",
    minDate: "today",
    disable: disabledDates,
    onChange: function (selectedDates, dateStr) {
        checkinDate = dateStr;

        // Enforce minimum 1 night stay (safe way)
        checkoutCalendar.set(
            "minDate",
            selectedDates[0].fp_incr(1)
        );

        checkoutCalendar.open()
        // Reset checkout when check-in changes
        checkoutCalendar.clear();
        document.getElementById("continueBtn").disabled = true;
    }
});

// Continue button
document.getElementById("continueBtn").onclick = () => {
    const params = new URLSearchParams({
        check_in: checkinDate,
        check_out: checkoutDate,
    });

    window.location.href = `/booking/{{ room.id }}/?${params}`;
};

// ðŸ”‘ OPEN CHECK-IN WHEN MODAL OPENS
document.getElementById("checkAvailability").onclick = () => {
    calendarWrapper.classList.remove("hidden");

    // Small delay ensures modal is visible
    setTimeout(() => {
        checkinCalendar.open();
    }, 100);

};

const closeModal = document.getElementById("close-modal");

function closeCalendar() {
    calendarWrapper.classList.add("hidden");
}

closeModal.addEventListener("click", function (e) {

    if (e.target === closeModal) {
        closeCalendar();
    }
});


</script>